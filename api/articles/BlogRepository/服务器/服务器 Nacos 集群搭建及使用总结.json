{"title":"服务器 Nacos 集群搭建及使用总结","uid":"77e6eaf05689d833633a4c139786f8ac","slug":"BlogRepository/服务器/服务器 Nacos 集群搭建及使用总结","date":"2022-02-07T15:46:19.000Z","updated":"2023-04-20T13:57:44.632Z","comments":true,"path":"api/articles/BlogRepository/服务器/服务器 Nacos 集群搭建及使用总结.json","keywords":null,"cover":"https://cover.png","content":"<h1 id=\"1-架构图\"><a href=\"#1-架构图\" class=\"headerlink\" title=\"1. 架构图\"></a>1. 架构图</h1><p><img src=\"http://img.fan223.cn/2023/04/20230419201944.png\"></p>\n<p>实际使用：</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419201956.png\"></p>\n<h1 id=\"2-下载\"><a href=\"#2-下载\" class=\"headerlink\" title=\"2. 下载\"></a>2. <a href=\"https://github.com/alibaba/nacos/releases\">下载</a></h1><p><strong>官网地址：<a href=\"https://nacos.io/zh-cn/\">home (nacos.io)</a></strong></p>\n<p><strong>GitHub 下载地址：<a href=\"https://github.com/alibaba/nacos/releases\">Releases · alibaba&#x2F;nacos (github.com)</a></strong></p>\n<p>选择对应版本进行下载，下载有可能会很慢</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202009.png\"></p>\n<h1 id=\"3-单机模式\"><a href=\"#3-单机模式\" class=\"headerlink\" title=\"3. 单机模式\"></a>3. 单机模式</h1><p>1、下载完成后上传到服务器</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202021.png\"></p>\n<p>2、解压文件</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>tar -zxvf nacos-server-2.2.0.tar.gz</p></blockquote>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202029.png\"></p>\n<p>3、重命名一下文件（非必要）</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>mv nacos nacos-2.2.0</p></blockquote>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202040.png\"></p>\n<p>4、进入 Nacos 的 conf 目录下，在 Nacos 配置文件 application.properties 里设置端口为 3333（默认为 8848），并且设置 MySQL 连接属性进行持久化配置，这里的 nacos_config 数据库使用 Nacos 自带的 mysql-schema.sql 数据库脚本构建</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202050.png\"></p>\n<pre class=\"line-numbers language-properties\" data-language=\"properties\"><code class=\"language-properties\">server.port&#x3D;3333\n\n###########################################################\nspring.datasource.platform&#x3D;mysql\n \ndb.num&#x3D;1\ndb.url.0&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;nacos_config?characterEncoding&#x3D;utf8&amp;connectTimeout&#x3D;1000&amp;socketTimeout&#x3D;3000&amp;autoReconnect&#x3D;true&amp;useUnicode&#x3D;true&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;UTC\ndb.user.0&#x3D;root\ndb.password.0&#x3D;xxx</code></pre>\n\n<p>5、进入 Nacos 的 bin 目录下，直接执行如下命令即可启动</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">sh startup.sh -m standalone\n或者 .&#x2F;startup.sh -m standalone</code></pre>\n\n<p>由于 Nacos 默认模式为 cluster，即集群模式，需设置启动参数 <code>-m standalone</code> 为单机模式，也可在 application.properties 配置文件里修改默认模式为单机模式，则可直接通过 <code>./startup.sh</code> 启动单机模式</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202102.png\"></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202113.png\"></p>\n<h1 id=\"4-集群模式\"><a href=\"#4-集群模式\" class=\"headerlink\" title=\"4. 集群模式\"></a>4. 集群模式</h1><h2 id=\"4-1-配置-Nacos\"><a href=\"#4-1-配置-Nacos\" class=\"headerlink\" title=\"4.1 配置 Nacos\"></a>4.1 配置 Nacos</h2><p>前 4 步与单机版同</p>\n<p>5、复制 cluster.conf.example 文件为 cluster.conf</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>cp cluster.conf.example cluster.conf</p></blockquote>\n<p>6、在集群配置文件 cluster.conf 里配置集群节点，<strong>IP:Port</strong>，IP 为服务器 IP 地址，端口为 Nacos 的端口，即 application.properties 配置文件里的 server.port&#x3D;3333，包括其他集群节点的端口，同时在服务器防火墙中开放需要访问的端口 3333、4444、5555</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">10.0.4.9:3333\n10.0.4.9:4444\n10.0.4.9:5555</code></pre>\n\n<p>7、以集群模式启动，<code>./startup.sh</code></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202128.png\"></p>\n<p>可以看到 3333 的节点已经启动</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202138.png\"></p>\n<p>8、如法炮制，再复制两份 Nacos，在 application.properties 配置文件里分别设置端口为 4444、5555，这样就有了三个 Nacos 文件，端口分别为 3333、4444、5555，并且在 cluster.conf 配置文件里都配置了这三个节点</p>\n<p>9、分别启动三个 Nacos，假如服务器内存不够，会出现只能启动一两个，三个服务不能全部启动的情况，或者启动另一个之后，之前启动的服务关闭，可以修改 startup.sh 文件的启动参数数值大小，改小一点</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">JAVA_OPT&#x3D;&quot;$&#123;JAVA_OPT&#125; -server -Xms1g -Xmx1g -Xmn512m -XX:MetaspaceSize&#x3D;128m -XX:MaxMetaspaceSize&#x3D;320m&quot;</code></pre>\n\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202151.png\"></p>\n<h2 id=\"4-2-配置-Nginx\"><a href=\"#4-2-配置-Nginx\" class=\"headerlink\" title=\"4.2 配置 Nginx\"></a>4.2 配置 Nginx</h2><p>1、进入 Nginx 的 conf 目录下修改配置文件 nginx.conf</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"># 代理转发地址\nupstream cluster&#123;\n        server 124.222.xxx.90:3333;\n        server 124.222.xxx.90:4444;\n        server 124.222.xxx.90:5555;\n&#125;\n\nserver &#123;\n        listen       1111; # 监听端口\n        server_name  124.222.xxx.90; # 访问地址\n\n        #charset koi8-r;\n\n        #access_log  logs&#x2F;host.access.log  main;\n\n        location &#x2F; &#123;\n            #root   html;\n            #index  index.html index.htm;\n            proxy_pass http:&#x2F;&#x2F;cluster;\n        &#125;\n&#125;</code></pre>\n\n<p>2、在服务器的防火墙里开放监听端口，即 1111</p>\n<p>3、进入 Nginx 的 sbin 目录下，执行命令启动 Nginx</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">.&#x2F;nginx\n或指定配置文件启动：.&#x2F;nginx -c &#x2F;usr&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</code></pre>\n\n<p>假如 Nginx 已启动，则执行</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>.&#x2F;nginx -s reload</p></blockquote>\n<p>重新加载 Nginx 即可</p>\n<p>4、访问 124.222.xxx.90:1111&#x2F;nacos，其实就是转发到访问 124.222.xxx.90:3333&#x2F;nacos 或 124.222.xxx.90:4444&#x2F;nacos 或 124.222.xxx.90:5555&#x2F;nacos</p>\n<p>5、查看 Nacos 的启动情况，在集群节点里可以看到三个节点全是 UP 的状态，由于服务器内存原因，这里只启动了两个，内存不够了</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202227.png\"></p>\n<h1 id=\"5-微服务注册进-Nacos\"><a href=\"#5-微服务注册进-Nacos\" class=\"headerlink\" title=\"5. 微服务注册进 Nacos\"></a>5. 微服务注册进 Nacos</h1><h2 id=\"5-1-引入依赖\"><a href=\"#5-1-引入依赖\" class=\"headerlink\" title=\"5.1 引入依赖\"></a>5.1 引入依赖</h2><p>这里用的是 Spring Cloud，假如只使用 Spring Boot 参考官网的 Spring Boot 快速开始：<a href=\"https://nacos.io/zh-cn/docs/quick-start-spring-boot.html\">Nacos Spring Boot 快速开始</a></p>\n<p>按照对应关系来选择对应的版本，这里使用的版本是 Spring Boot 2.7.7、Spring Cloud Alibaba 2021.0.4.0、Spring Cloud 2021.0.4</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202240.png\"></p>\n<h2 id=\"5-2-修改配置文件\"><a href=\"#5-2-修改配置文件\" class=\"headerlink\" title=\"5.2 修改配置文件\"></a>5.2 修改配置文件</h2><pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">spring:\n  application:\n    name: discovery-config\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 124.222.xxx.90:3333</code></pre>\n\n<h2 id=\"5-3-添加注解\"><a href=\"#5-3-添加注解\" class=\"headerlink\" title=\"5.3 添加注解\"></a>5.3 添加注解</h2><p>在启动类上添加 Spring Cloud 原生注解 <code>@EnableDiscoveryClient</code> 开启服务注册发现功能</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@SpringBootApplication\n@EnableDiscoveryClient\npublic class DemoApplication &#123;\n    public static void main(String[] args) &#123;\n        SpringApplication.run(DemoApplication.class, args);\n    &#125;\n&#125;</code></pre>\n\n<h2 id=\"5-4-注意\"><a href=\"#5-4-注意\" class=\"headerlink\" title=\"5.4 注意\"></a>5.4 注意</h2><p>Nacos2.0 版本相比 1.X 新增了 GRPC 的通信方式，Nacos 2.0 的 GRPC 端口都是通过主端口的偏移量产生，GRPC 端口 &#x3D; Nacos 主端口 + 1000，因此还要额外开放 主端口 + 1000 的端口，如主端口为 3333，则还需开放端口 4333，这里为客户端 GRPC 请求服务端端口。假如服务端 GRPC 请求服务端接口，还需开放偏移量为 1001 的端口，即 4334</p>\n<p><strong>否则会报 <code>com.alibaba.nacos.api.exception.NacosException: Client not connected, current status:STARTING</code> 异常</strong></p>\n<h2 id=\"5-5-启动\"><a href=\"#5-5-启动\" class=\"headerlink\" title=\"5.5 启动\"></a>5.5 启动</h2><p>启动主启动类后，即可在 Nacos 管理页面看到服务已经被注册了进来</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202252.png\"></p>\n<h1 id=\"6-Nacos-作为配置中心\"><a href=\"#6-Nacos-作为配置中心\" class=\"headerlink\" title=\"6. Nacos 作为配置中心\"></a>6. Nacos 作为配置中心</h1><p><strong>在上面注册中心的基础上</strong></p>\n<h2 id=\"6-1-引入依赖\"><a href=\"#6-1-引入依赖\" class=\"headerlink\" title=\"6.1 引入依赖\"></a>6.1 引入依赖</h2><p>由于在 SpringCloud 2020.* 版本把 bootstrap 禁用了，导致在读取文件的时候读取不到报错 <code>No spring.config.import property has been defined</code>，所以要重新引入 bootstrap 依赖</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;&#x2F;artifactId&gt;\n&lt;&#x2F;dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;&#x2F;artifactId&gt;\n&lt;&#x2F;dependency&gt;</code></pre>\n\n<h2 id=\"6-2-配置\"><a href=\"#6-2-配置\" class=\"headerlink\" title=\"6.2 配置\"></a>6.2 配置</h2><p>这里需要两个配置文件 bootstrap.yml 和 application.yml，在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动。而 SpringBoot 中配置文件的加载是存在优先级顺序的，bootstrap 优先级高于 application</p>\n<p><strong>1、bootstrap.yml</strong></p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">server:\n  port: 9001\n\nspring:\n  application:\n    name: discovery-config\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 124.222.xxx.90:3333\n      config:\n        server-addr: 124.222.xxx.90:3333\n        file-extension: yaml # 指定 yaml 格式的配置</code></pre>\n\n<p><strong>2、application.yml</strong></p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">spring:\n profiles:\n   active: dev # 表示开发环境</code></pre>\n\n<h2 id=\"6-3-ConfigController\"><a href=\"#6-3-ConfigController\" class=\"headerlink\" title=\"6.3 ConfigController\"></a>6.3 ConfigController</h2><p>通过 SpringCloud 原生注解 <code>@RefreshScope</code> 实现配置的自动更新</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@RestController\n@RefreshScope\npublic class ConfigController &#123;\n\n    @Value(&quot;$&#123;config.info&#125;&quot;)\n    private String configInfo;\n\n    @GetMapping(&quot;&#x2F;config&#x2F;info&quot;)\n    public String getConfigInfo() &#123;\n        return configInfo;\n    &#125;\n&#125;</code></pre>\n\n<h2 id=\"6-4-持久化配置\"><a href=\"#6-4-持久化配置\" class=\"headerlink\" title=\"6.4 持久化配置\"></a>6.4 持久化配置</h2><p>在 Nacos 的配置列表里新建一个配置，这里的 Data ID，计算公式为：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}</p></blockquote>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202304.png\"></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202312.png\"></p>\n<p>在前面已经配置好了持久化配置属性，配置信息会保存到数据库中</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202321.png\"></p>\n<h2 id=\"6-5-查看配置\"><a href=\"#6-5-查看配置\" class=\"headerlink\" title=\"6.5 查看配置\"></a>6.5 查看配置</h2><p>启动服务，访问 <code>http://localhost:9001/config/info</code>，即可读取到配置中心的配置信息</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202333.png\"></p>\n<p>更新一下配置信息</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202343.png\"></p>\n<p>可以发现读取的配置信息也随之动态刷新</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202352.png\"></p>\n<h2 id=\"6-6-加载方案\"><a href=\"#6-6-加载方案\" class=\"headerlink\" title=\"6.6 加载方案\"></a>6.6 加载方案</h2><h3 id=\"6-61-Data-ID-方案\"><a href=\"#6-61-Data-ID-方案\" class=\"headerlink\" title=\"6.61 Data ID 方案\"></a>6.61 Data ID 方案</h3><p>默认空间 + 默认分组 + Data ID，主要通过不同的 Data ID 来进行区分，即上面的配置</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202402.png\"></p>\n<h3 id=\"6-6-2-Group-方案\"><a href=\"#6-6-2-Group-方案\" class=\"headerlink\" title=\"6.6.2 Group 方案\"></a>6.6.2 Group 方案</h3><p>通过 Group 实现环境区分</p>\n<p>1、新建 Group</p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202414.png\"></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202423.png\"></p>\n<p><strong>2、增加 group 配置</strong></p>\n<p>bootstrap.yml</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">server:\n  port: 9001\n\nspring:\n  application:\n    name: discovery-config\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 124.222.xxx.90:3333\n      config:\n        server-addr: 124.222.xxx.90:3333\n        file-extension: yaml\n        group: DEV_GROUP</code></pre>\n\n<p>application.yml</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">spring:\n  profiles:\n    # active: dev # 表示开发环境\n    active: info # 表示开发环境</code></pre>\n\n<h3 id=\"6-6-3-Namespace-方案\"><a href=\"#6-6-3-Namespace-方案\" class=\"headerlink\" title=\"6.6.3 Namespace 方案\"></a>6.6.3 Namespace 方案</h3><p><strong>1、新建命名空间</strong></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202433.png\"></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202442.png\"></p>\n<p><strong>2、选择该命名空间进行配置管理</strong></p>\n<p><img src=\"http://img.fan223.cn/2023/04/20230419202451.png\"></p>\n<p><strong>3、配置命名空间</strong></p>\n<p>bootstrap.yml</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">server:\n  port: 9001\n\nspring:\n  application:\n    name: discovery-config\n  cloud:\n    nacos:\n      discovery:\n        server-addr: 124.222.118.90:8848\n      config:\n        server-addr: 124.222.118.90:8848\n        file-extension: yaml\n        namespace: a404abf6-f7ca-40f5-a106-2a892793fb48</code></pre>\n","feature":false,"text":"1. 架构图 实际使用： 2. 下载官网地址：home (nacos.io) GitHub 下载地址：Releases · alibaba&#x2F;nacos (github.com) 选择对应版本进行下载，下载有可能会很慢 3. 单机模式1、下载完成后上传到服务器 2、解压文...","link":"","photos":[],"count_time":{"symbolsCount":"6.3k","symbolsTime":"6 mins."},"categories":[{"name":"服务器","slug":"服务器","count":4,"path":"api/categories/服务器.json"}],"tags":[{"name":"服务器","slug":"服务器","count":5,"path":"api/tags/服务器.json"},{"name":"Nacos","slug":"Nacos","count":1,"path":"api/tags/Nacos.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-%E6%9E%B6%E6%9E%84%E5%9B%BE\"><span class=\"toc-text\">1. 架构图</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2-%E4%B8%8B%E8%BD%BD\"><span class=\"toc-text\">2. 下载</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3-%E5%8D%95%E6%9C%BA%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">3. 单机模式</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#4-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">4. 集群模式</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-1-%E9%85%8D%E7%BD%AE-Nacos\"><span class=\"toc-text\">4.1 配置 Nacos</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-2-%E9%85%8D%E7%BD%AE-Nginx\"><span class=\"toc-text\">4.2 配置 Nginx</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#5-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E8%BF%9B-Nacos\"><span class=\"toc-text\">5. 微服务注册进 Nacos</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">5.1 引入依赖</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-2-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">5.2 修改配置文件</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-3-%E6%B7%BB%E5%8A%A0%E6%B3%A8%E8%A7%A3\"><span class=\"toc-text\">5.3 添加注解</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-4-%E6%B3%A8%E6%84%8F\"><span class=\"toc-text\">5.4 注意</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-5-%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">5.5 启动</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#6-Nacos-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83\"><span class=\"toc-text\">6. Nacos 作为配置中心</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96\"><span class=\"toc-text\">6.1 引入依赖</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-2-%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">6.2 配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-3-ConfigController\"><span class=\"toc-text\">6.3 ConfigController</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-4-%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">6.4 持久化配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-5-%E6%9F%A5%E7%9C%8B%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">6.5 查看配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-6-%E5%8A%A0%E8%BD%BD%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">6.6 加载方案</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-61-Data-ID-%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">6.61 Data ID 方案</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-6-2-Group-%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">6.6.2 Group 方案</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-6-3-Namespace-%E6%96%B9%E6%A1%88\"><span class=\"toc-text\">6.6.3 Namespace 方案</span></a></li></ol></li></ol></li></ol>","author":{"name":"凡","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"https://github.com/Fan223","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/7318914058","zhihu":"https://www.zhihu.com/people/tridiamond","csdn":"https://blog.csdn.net/ACE_U_005A","juejin":"https://juejin.cn/user/1873223546578589","customs":{}}},"mapped":true,"prev_post":{"title":"轻量应用服务器部署 SpringBoot 前后端分离项目","uid":"5a21c09ba3fee0fc771792aaefbd27f1","slug":"BlogRepository/服务器/轻量应用服务器部署 SpringBoot 前后端分离项目","date":"2022-02-09T15:59:34.000Z","updated":"2023-04-20T13:57:44.632Z","comments":true,"path":"api/articles/BlogRepository/服务器/轻量应用服务器部署 SpringBoot 前后端分离项目.json","keywords":null,"cover":"https://cover.png","text":"部署 Nginx 见：轻量应用服务器使用总结 1. 前端项目部署1、这里使用的是 vue 项目，运行 npm run build，会生成一个 dist 文件夹 2、把文件上传到服务器 Nginx 安装目录的 html 目录下，先压缩成 ZIP 包上传然后再解压，然后重命名为 bl...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"服务器","slug":"服务器","count":4,"path":"api/categories/服务器.json"}],"tags":[{"name":"服务器","slug":"服务器","count":5,"path":"api/tags/服务器.json"},{"name":"SpringBoot","slug":"SpringBoot","count":4,"path":"api/tags/SpringBoot.json"}],"author":{"name":"凡","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"https://github.com/Fan223","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/7318914058","zhihu":"https://www.zhihu.com/people/tridiamond","csdn":"https://blog.csdn.net/ACE_U_005A","juejin":"https://juejin.cn/user/1873223546578589","customs":{}}},"feature":false},"next_post":{"title":"Git 总结","uid":"bd0b4d58af50c3051be665f36056fa92","slug":"BlogRepository/开发工具及环境/Git 总结","date":"2022-01-26T15:54:45.000Z","updated":"2023-04-20T13:57:44.632Z","comments":true,"path":"api/articles/BlogRepository/开发工具及环境/Git 总结.json","keywords":null,"cover":"https://cover.png","text":"1. 下载点击https://git-scm.com/downloads，前往下载页面 这里选择 Windows，选择对应的位数下载 2. 安装选择安装组件，Next Next 选择在 Git 中使用的编辑器，按自己选择，Next 或者选择自定义编辑器 选择 Git init 命...","link":"","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"开发技术及框架","slug":"开发技术及框架","count":9,"path":"api/categories/开发技术及框架.json"}],"tags":[{"name":"Git","slug":"Git","count":1,"path":"api/tags/Git.json"}],"author":{"name":"凡","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"https://github.com/Fan223","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/7318914058","zhihu":"https://www.zhihu.com/people/tridiamond","csdn":"https://blog.csdn.net/ACE_U_005A","juejin":"https://juejin.cn/user/1873223546578589","customs":{}}},"feature":false}}